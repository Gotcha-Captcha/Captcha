<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>AI ReCaptcha Solver Dashboard</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#135bec",
                        "accent-green": "#00ff41",
                        "background-light": "#f6f6f8",
                        "background-dark": "#0a0c12",
                        "surface-dark": "#161b26",
                        "border-dark": "#282e39",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk"]
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
        }

        .terminal-scroll::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-scroll::-webkit-scrollbar-track {
            background: #0a0c12;
        }

        .terminal-scroll::-webkit-scrollbar-thumb {
            background: #282e39;
            border-radius: 4px;
        }

        .scanner-line {
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ff41, transparent);
            box-shadow: 0 0 15px #00ff41;
            position: absolute;
            width: 100%;
            top: 0;
            z-index: 10;
            display: none;
            animation: scan 2s linear infinite;
        }

        @keyframes scan {
            from {
                top: 0%
            }

            to {
                top: 100%
            }
        }

        .typing-cursor {
            border-right: 2px solid #4d90fe;
            animation: blink 0.7s infinite;
        }

        @keyframes blink {

            from,
            to {
                border-color: transparent
            }

            50% {
                border-color: #4d90fe
            }
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark text-white min-h-screen flex flex-col">
    <!-- TopNavBar -->
    <header
        class="flex items-center justify-between whitespace-nowrap border-b border-solid border-border-dark bg-background-dark px-10 py-3 z-30">
        <div class="flex items-center gap-4 text-white">
            <div class="size-6 text-primary">
                <svg fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M44 11.2727C44 14.0109 39.8386 16.3957 33.69 17.6364C39.8386 18.877 44 21.2618 44 24C44 26.7382 39.8386 29.123 33.69 30.3636C39.8386 31.6043 44 33.9891 44 36.7273C44 40.7439 35.0457 44 24 44C12.9543 44 4 40.7439 4 36.7273C4 33.9891 8.16144 31.6043 14.31 30.3636C8.16144 29.123 4 26.7382 4 24C4 21.2618 8.16144 18.877 14.31 17.6364C8.16144 16.3957 4 14.0109 4 11.2727C4 7.25611 12.9543 4 24 4C35.0457 4 44 7.25611 44 11.2727Z"
                        fill="currentColor"></path>
                </svg>
            </div>
            <h2 class="text-white text-lg font-bold leading-tight tracking-tight">Gotcha! <span
                    class="text-primary">v2.0</span></h2>
            <span
                class="ml-4 px-2 py-0.5 rounded bg-accent-green/10 text-accent-green text-xs font-mono border border-accent-green/20">FastAPI:
                ONLINE</span>
        </div>
        <div class="flex flex-1 justify-end gap-8">
            <div class="flex gap-3">
                <button
                    class="flex items-center justify-center rounded-lg h-10 w-10 bg-surface-dark border border-border-dark text-white hover:bg-border-dark transition-colors">
                    <span class="material-symbols-outlined text-lg">settings</span>
                </button>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- SideNavBar / Control Panel -->
        <aside
            class="w-80 bg-surface-dark border-r border-border-dark flex flex-col justify-between p-6 overflow-y-auto">
            <div class="flex flex-col gap-8">
                <div>
                    <h1 class="text-white text-xs font-bold uppercase tracking-widest mb-4 opacity-50">Model Metrics
                    </h1>
                    <div class="space-y-3">
                        <div class="p-4 rounded-xl bg-background-dark border border-border-dark">
                            <div class="flex flex-col gap-1">
                                <p class="text-[#9da6b9] text-[10px] font-bold uppercase tracking-tight">Word Accuracy
                                </p>
                                <span class="text-primary text-lg font-bold">{{ metrics.accuracy }}</span>
                            </div>
                            <p class="text-[10px] text-[#475569] mt-2 leading-tight">Entire 5-character sequence must be
                                perfect. One wrong letter = 0% success.</p>
                        </div>
                        <div class="p-4 rounded-xl bg-background-dark border border-border-dark">
                            <div class="flex flex-col gap-1">
                                <p class="text-[#9da6b9] text-[10px] font-bold uppercase tracking-tight">Character
                                    Accuracy</p>
                                <span class="text-accent-green text-lg font-bold">{{ metrics.char_accuracy }}</span>
                            </div>
                            <p class="text-[10px] text-[#475569] mt-2 leading-tight">Percentage of individual letters
                                correctly recognized across all samples.</p>
                        </div>
                        <div class="grid grid-cols-3 gap-3">
                            <div
                                class="p-3 rounded-xl bg-background-dark border border-border-dark flex flex-col gap-1">
                                <p class="text-[#9da6b9] text-[8px] font-bold uppercase tracking-tight">Precision</p>
                                <span class="text-white text-sm font-bold">{{ metrics.precision }}</span>
                            </div>
                            <div
                                class="p-3 rounded-xl bg-background-dark border border-border-dark flex flex-col gap-1">
                                <p class="text-[#9da6b9] text-[8px] font-bold uppercase tracking-tight">Recall</p>
                                <span class="text-white text-sm font-bold">{{ metrics.recall }}</span>
                            </div>
                            <div
                                class="p-3 rounded-xl bg-background-dark border border-border-dark flex flex-col gap-1">
                                <p class="text-[#9da6b9] text-[8px] font-bold uppercase tracking-tight">F1-Score</p>
                                <span class="text-white text-sm font-bold">{{ metrics.f1_score }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col gap-4">
                    <p class="text-white text-xs font-bold uppercase tracking-widest mb-2 opacity-50">System Info</p>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-[#9da6b9]">Status</span>
                            <span class="text-accent-green font-medium">Pre-trained</span>
                        </div>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-[#9da6b9]">Architecture</span>
                            <span class="text-white font-medium">{{ metrics.type }}</span>
                        </div>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-[#9da6b9]">Loss Function</span>
                            <span class="text-white font-medium">{{ metrics.loss }}</span>
                        </div>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-[#9da6b9]">Loss Value</span>
                            <span class="text-accent-green font-mono font-bold">{{ metrics.loss_value }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pt-6 border-t border-border-dark">
                <p class="text-[10px] text-[#475569] text-center">Â© 2026 Captcha-Recognition Project</p>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col bg-background-dark overflow-y-auto">
            <!-- Page Heading -->
            <div class="flex flex-wrap justify-between items-center gap-3 p-8 border-b border-border-dark/50">
                <div class="flex flex-col gap-1">
                    <p class="text-white text-3xl font-black leading-tight tracking-tight">AI ReCaptcha Solver</p>
                    <p class="text-[#9da6b9] text-sm font-normal">Native CRNN+CTC Simulation Feed</p>
                </div>
                <div class="flex gap-3">
                    <span
                        class="px-3 py-1.5 rounded-lg bg-surface-dark border border-border-dark text-accent-green text-xs font-mono"
                        id="main-status">
                        READY
                    </span>
                </div>
            </div>

            <div class="p-8 space-y-8">
                <!-- Main Layout Split -->
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <!-- Challenge Feed -->
                    <div class="lg:col-span-7 flex flex-col gap-6">
                        <!-- Tab System -->
                        <div class="flex gap-2 p-1 bg-surface-dark rounded-lg border border-border-dark w-fit">
                            <button id="tab-v1"
                                class="px-4 py-2 rounded-md bg-primary text-white text-xs font-bold transition-all">v1:
                                Text Captcha</button>
                            <button id="tab-v2"
                                class="px-4 py-2 rounded-md text-[#9da6b9] text-xs font-bold hover:text-white transition-all relative">
                                v2: Image Select
                                <span
                                    class="absolute -top-2 -right-2 px-1.5 py-0.5 bg-accent-green text-black text-[8px] font-black rounded uppercase">Soon</span>
                            </button>
                        </div>

                        <div class="flex items-center justify-between">
                            <h2 class="text-white text-xl font-bold tracking-tight flex items-center gap-2">
                                <span class="relative flex h-2 w-2">
                                    <span
                                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-2 w-2 bg-primary"></span>
                                </span>
                                Active Challenge
                            </h2>
                            <button id="refresh-challenge"
                                class="text-xs font-mono text-primary hover:text-white transition-colors flex items-center gap-1">
                                <span class="material-symbols-outlined text-sm">refresh</span> REGENERATE
                            </button>
                        </div>

                        <div id="challenge-container"
                            class="relative bg-surface-dark rounded-xl border border-border-dark shadow-inner overflow-hidden min-h-[140px] flex items-center justify-center p-4 group">
                            <div
                                class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-primary/10 via-transparent to-transparent">
                            </div>
                            <img id="challenge-img" src=""
                                class="h-16 w-auto object-contain transition-all duration-500 group-hover:scale-110 drop-shadow-[0_0_10px_rgba(19,91,236,0.3)] z-10"
                                alt="Challenge" />
                            <div id="scanner" class="scanner-line z-20"></div>
                        </div>

                        <!-- Solver Controls -->
                        <div class="bg-surface-dark border border-border-dark rounded-xl p-6 space-y-4">
                            <div class="space-y-2">
                                <div class="flex justify-between items-end">
                                    <label class="text-[10px] font-bold text-[#9da6b9] uppercase tracking-widest">Input
                                        Buffer</label>
                                    <span id="solver-status" class="text-[10px] text-accent-green font-mono">IDLE</span>
                                </div>
                                <input type="text" id="captcha-solve-input"
                                    class="w-full bg-background-dark border border-border-dark rounded-lg px-4 py-4 text-white text-4xl font-black tracking-[0.3em] focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-border-dark"
                                    placeholder="-----">
                            </div>

                            <div class="flex gap-3">
                                <button id="btn-auto-solve"
                                    class="flex-1 flex items-center justify-center gap-2 bg-primary text-white px-6 py-4 rounded-lg text-sm font-bold hover:brightness-110 transition-all shadow-lg shadow-primary/20">
                                    <span class="material-symbols-outlined">psychology</span>
                                    AI AUTO-SOLVE
                                </button>
                                <button id="btn-verify-solve"
                                    class="flex-1 flex items-center justify-center gap-2 bg-accent-green text-black px-6 py-4 rounded-lg text-sm font-bold hover:brightness-110 transition-all shadow-lg shadow-accent-green/20">
                                    <span class="material-symbols-outlined">verified</span>
                                    VERIFY & SUBMIT
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Log Terminal -->
                    <div class="lg:col-span-5 flex flex-col gap-4">
                        <div class="flex items-center justify-between">
                            <h2 class="text-white text-xl font-bold tracking-tight">System Terminal</h2>
                            <button id="clear-terminal"
                                class="text-[10px] font-bold text-[#9da6b9] uppercase hover:text-white transition-colors">Clear</button>
                        </div>
                        <div
                            class="flex-1 bg-background-dark border border-border-dark rounded-xl overflow-hidden flex flex-col min-h-[500px]">
                            <div
                                class="bg-surface-dark px-4 py-2 border-b border-border-dark flex items-center justify-between">
                                <div class="flex gap-1.5">
                                    <div class="w-2.5 h-2.5 rounded-full bg-red-500/50"></div>
                                    <div class="w-2.5 h-2.5 rounded-full bg-yellow-500/50"></div>
                                    <div class="w-2.5 h-2.5 rounded-full bg-green-500/50"></div>
                                </div>
                                <span class="text-[10px] font-mono text-[#9da6b9]">root@gotcha-ai: ~/session/logs</span>
                            </div>
                            <div id="terminal-content"
                                class="flex-1 p-4 font-mono text-[11px] space-y-2 overflow-y-auto terminal-scroll">
                                <p class="text-accent-green font-bold">>> Gotcha! AI System Started</p>
                                <p class="text-[#9da6b9]">>> Model Status: {{ status }}</p>
                                <p class="text-[#9da6b9]">>> Simulation Environment: READY</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>


    <!-- Status Bar -->
    <footer class="bg-surface-dark border-t border-border-dark px-6 py-2 flex items-center justify-between z-30">
        <div class="flex items-center gap-6 text-[10px] font-mono text-[#9da6b9]">
            <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-accent-green shadow-[0_0_5px_#00ff41]"></span>
                ENGINE: ACTIVE
            </div>
            <div class="hidden md:flex items-center gap-2 border-l border-border-dark pl-6">
                <span class="material-symbols-outlined text-[12px]">memory</span>
                INFERENCE UNIT: GPU-0
            </div>
        </div>
        <div class="text-[10px] font-mono text-primary font-bold">
            BUILD: v2.0.4-STABLE
        </div>
    </footer>

    <script>
        // DOM Elements
        const terminalContent = document.getElementById('terminal-content');
        const clearTerminal = document.getElementById('clear-terminal');
        const mainStatus = document.getElementById('main-status');

        const challengeImg = document.getElementById('challenge-img');
        const captchaInput = document.getElementById('captcha-solve-input');
        const btnAutoSolve = document.getElementById('btn-auto-solve');
        const btnVerify = document.getElementById('btn-verify-solve');
        const refreshChallenge = document.getElementById('refresh-challenge');
        const solverStatus = document.getElementById('solver-status');
        const scanner = document.getElementById('scanner');

        const tabV1 = document.getElementById('tab-v1');
        const tabV2 = document.getElementById('tab-v2');

        let currentChallengeId = null;

        // Helper: Log to terminal
        function log(msg, type = 'info') {
            const time = new Date().toLocaleTimeString('en-GB', { hour12: false });
            const p = document.createElement('p');
            const typeColor = type === 'success' ? 'text-accent-green' : type === 'error' ? 'text-red-500' : 'text-primary';
            p.innerHTML = `<span class="text-[#9da6b9]">[${time}]</span> <span class="${typeColor} font-bold">${type.toUpperCase()}:</span> ${msg}`;
            terminalContent.appendChild(p);
            terminalContent.scrollTop = terminalContent.scrollHeight;
        }

        clearTerminal.onclick = () => terminalContent.innerHTML = '<p class="text-accent-green font-bold">>> Console session cleared</p>';

        // --- Challenge Logic ---
        async function loadChallenge() {
            log('Requesting new challenge from dataset...');
            scanner.style.display = 'block';
            mainStatus.innerText = 'FETCHING';
            mainStatus.classList.add('text-yellow-500');

            try {
                const response = await fetch('/api/challenge');
                const data = await response.json();

                challengeImg.src = data.image;
                currentChallengeId = data.challenge_id;
                captchaInput.value = "";
                solverStatus.innerText = "READY";
                solverStatus.classList.remove('text-red-500');

                log(`Challenge loaded: ${currentChallengeId}`, 'success');
            } catch (err) {
                log(`Failed to load challenge: ${err.message}`, 'error');
            } finally {
                scanner.style.display = 'none';
                mainStatus.innerText = 'READY';
                mainStatus.classList.remove('text-yellow-500');
            }
        }

        refreshChallenge.onclick = loadChallenge;

        btnAutoSolve.onclick = async () => {
            if (!currentChallengeId) return;

            btnAutoSolve.disabled = true;
            log('Initializing AI solving unit...', 'info');
            solverStatus.innerText = "ANALYZING...";
            mainStatus.innerText = 'SOLVING';

            try {
                const response = await fetch('/api/solve', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ challenge_id: currentChallengeId })
                });
                const data = await response.json();

                // Typing effect
                captchaInput.value = "";
                captchaInput.classList.add('typing-cursor');
                const text = data.prediction;
                for (let i = 0; i < text.length; i++) {
                    captchaInput.value += text[i];
                    await new Promise(r => setTimeout(r, 100));
                }
                captchaInput.classList.remove('typing-cursor');

                log(`AI solve generated: "${text}"`, 'success');
                solverStatus.innerText = "SOLVE COMPLETE";
            } catch (error) {
                log('AI solving unit failed', 'error');
                solverStatus.innerText = "ERROR";
                solverStatus.classList.add('text-red-500');
            } finally {
                btnAutoSolve.disabled = false;
                mainStatus.innerText = 'READY';
            }
        };

        btnVerify.onclick = async () => {
            const userInput = captchaInput.value;
            if (!userInput || !currentChallengeId) return;

            log('Initiating server-side validation check...');
            mainStatus.innerText = 'VERIFYING';

            try {
                const response = await fetch('/api/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        challenge_id: currentChallengeId,
                        user_input: userInput
                    })
                });
                const data = await response.json();

                if (data.is_correct) {
                    log(`VERIFICATION SUCCESS: Input matches ground truth ("${data.true_label}")`, 'success');
                    solverStatus.innerText = "PASSED";
                    solverStatus.classList.replace('text-accent-green', 'text-green-400');

                    // Visual feedback
                    captchaInput.classList.add('border-accent-green');
                    mainStatus.innerText = 'SUCCESS';

                    setTimeout(() => {
                        captchaInput.classList.remove('border-accent-green');
                        loadChallenge();
                    }, 2000);
                } else {
                    log(`VERIFICATION FAILURE: Input mismatch. Ground truth was "${data.true_label}"`, 'error');
                    solverStatus.innerText = "FAILED";
                    solverStatus.classList.add('text-red-500');
                    captchaInput.classList.add('border-red-500');
                    mainStatus.innerText = 'FAILED';
                    setTimeout(() => {
                        captchaInput.classList.remove('border-red-500');
                        mainStatus.innerText = 'READY';
                    }, 1000);
                }
            } catch (err) {
                log(`Verification process failed: ${err.message}`, 'error');
            }
        };

        // Tab Switching Logic
        tabV1.onclick = () => {
            tabV1.classList.add('bg-primary', 'text-white');
            tabV1.classList.remove('text-[#9da6b9]');
            tabV2.classList.remove('bg-primary', 'text-white');
            tabV2.classList.add('text-[#9da6b9]');
            log('Switched to v1: Text Captcha mode');
        };

        tabV2.onclick = () => {
            log('v2: Image Select mode is currently in development.', 'info');
            // Logic for switching tabs could be added here if v2 was implemented
        };

        // Initial Load
        window.onload = loadChallenge;
    </script>
</body>

</html>